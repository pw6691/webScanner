<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beeper Settings</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        h2 {
            margin-top: 20px;
            font-size: 1.5em;
            padding-left: 20px;
        }
        .container {
            width: auto;
            padding: 20px;
            margin: 0 auto;
            display: none; /* Hide the container initially */
        }
        .parameter-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .parameter-name {
            font-weight: bold;
            margin-right: 20px;
            width: 150px;
            padding-left: 40px;
        }
        .parameter-dropdown select,
        .parameter-dropdown input[type="text"] {
            width: 250px;
            text-align: left;
        }
        input[type="file"] {
            margin-bottom: 20px;
            display: block;
        }
        .xml-output {
            margin-top: 20px;
            white-space: pre-wrap;
            padding: 10px;
            border: 1px solid #ccc;
            width: 1000px;
        }
        .file-input-container {
            position: absolute;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>

<div class="file-input-container">
    <input type="file" id="fileInput" accept=".scndef">
</div>

<div class="container"> 

    <h2>Statistics</h2>

    <div class="parameter-item">
        <label class="parameter-name" for="codeList">codeList</label>
        <div class="parameter-dropdown">
            <select id="codeList"></select>
        </div>
    </div>

    <div class="parameter-item">
        <label class="parameter-name" for="threshold">Threshold</label>
        <div class="parameter-dropdown">
            <select id="threshold"></select>
        </div>
    </div>

    <button id="generateXmlButton" class="generate-button">Generate XML</button>

    <div id="xmlOutput" class="xml-output"></div>
</div>

<script>
    let initialValues = {};

    document.getElementById('fileInput').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(e.target.result, "text/xml");

                // Function to populate a select element with options from the XML
                function populateSelect(parameterName, selectId) {
                    const parameter = xmlDoc.querySelector(`parameter[name="${parameterName}"]`);
                    if (parameter) {
                        const options = parameter.querySelectorAll('options option');
                        const select = document.getElementById(selectId);
                        select.innerHTML = ''; // Clear existing options
                        options.forEach(option => {
                            const value = option.getAttribute('value');
                            const caption = option.querySelector('caption').textContent;
                            const textId = option.querySelector('caption').getAttribute('text-id');
                            select.innerHTML += `<option value="${value}" data-text-id="${textId}">${caption}</option>`;
                        });
                        initialValues[parameterName] = {
                            value: select.options[0].value,
                            id: parameter.getAttribute('id')
                        };
                    }
                }

                // Populate the codeList dropdown
                populateSelect("codeList", "codeList");

                // Populate the threshold dropdown
                populateSelect("Threshold", "threshold");

                // Show the container after the file is loaded and parsed
                document.querySelector('.container').style.display = 'block';
            };
            reader.readAsText(file);
        }
    });

    document.getElementById('generateXmlButton').addEventListener('click', function() {
        const codeListSelect = document.getElementById('codeList');
        const thresholdSelect = document.getElementById('threshold');

        const codeListValue = codeListSelect.value;
        const codeListTextId = codeListSelect.selectedOptions[0].getAttribute('data-text-id');
        const codeListId = initialValues["codeList"].id;
        const thresholdValue = thresholdSelect.value;
        const thresholdTextId = thresholdSelect.selectedOptions[0].getAttribute('data-text-id');
        const thresholdId = initialValues["Threshold"].id;

        let xmlContent = '';

        if (codeListValue !== initialValues["codeList"].value) {
            xmlContent += `<group name="Statistics">\n  <parameter name="codeList" id="${codeListId}"> <option value="${codeListValue}"> <caption text-id="${codeListTextId}"/> </option> </parameter>\n</group>\n`;
        }

        if (thresholdValue !== initialValues["Threshold"].value) {
            xmlContent += `<group name="Statistics">\n  <parameter name="threshold" id="${thresholdId}"> <option value="${thresholdValue}"> <caption text-id="${thresholdTextId}"/> </option> </parameter>\n</group>\n`;
        }

        const xmlOutput = document.getElementById('xmlOutput');
        xmlOutput.textContent = xmlContent;

        console.log(xmlContent);
    });
</script>

</body>
</html>
